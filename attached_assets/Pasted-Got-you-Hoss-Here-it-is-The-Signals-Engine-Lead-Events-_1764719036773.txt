Got you, Hoss.
Here it is.
The Signals Engine + Lead Events + Todayâ€™s Opportunities Master Prompt â€” the one that elevates HossAgent from â€œAI lead gen SaaSâ€ into THE ETHICAL BRIEFCASE SYSTEM, your event-driven, moment-aware intelligence engine.

This is the Replit Assistant-compatible version â€” clean, linear, prescriptive, file-aware, and safe for incremental integration.

Copy/paste the whole thing into the Assistant.

No fences. No commentary.
Just the blueprint that rewires your productâ€™s soul.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

MAGIC BOX MASTER PLAN â€” SIGNALS ENGINE + LEAD EVENTS + TODAYâ€™S OPPORTUNITIES

I am ready to upgrade HossAgent from generic lead gen into the contextual, moment-aware â€œEthical Briefcase System.â€ Implement the following changes across the codebase. Follow the order carefully, make all edits incrementally and safely, and preserve existing features (BizDev, Ops, Billing, Auth, Portal, Admin console, Trial logic, etc.).

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SECTION 1 â€” Database Layer: Add Signals + Lead Events

Create two new SQLModel (or SQLAlchemy) models and migration-safe logic.

1. Add Signal model:
	â€¢	id (PK)
	â€¢	company_id (FK, nullable)
	â€¢	source_type (string)  # â€œjob_postingâ€, â€œreviewâ€, â€œcompetitor_updateâ€, etc.
	â€¢	raw_payload (text or JSON string)
	â€¢	context_summary (text, nullable)
	â€¢	created_at (datetime)

2. Add LeadEvent model:
	â€¢	id (PK)
	â€¢	company_id (FK)
	â€¢	signal_id (FK)
	â€¢	summary (text)
	â€¢	category (string)  # â€œgrowthâ€, â€œriskâ€, â€œcompetitor_moveâ€, â€œopportunityâ€
	â€¢	urgency_score (int, default 50)
	â€¢	status (string)  # â€œnewâ€, â€œqueuedâ€, â€œcontactedâ€, â€œrespondedâ€, â€œarchivedâ€
	â€¢	created_at (datetime)

3. Create migrations / auto-creation logic so existing user data is preserved.

4. Update Admin database access & listing utilities so these appear in the console for debugging.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SECTION 2 â€” Signals Agent (New Agent Module)

Create a new file: signals_agent.py with:

Function: run_signals_agent(db)

This agent will:
	1.	Fetch a list of existing customers (or companies in leads table).
	2.	For each, generate 0â€“3 synthetic v1 signals using simple heuristic mock providers:
	â€¢	Competitor update:
	â€¢	Use the companyâ€™s domain, generate a synthetic â€œcompetitor added offer / changed headlineâ€ signal.
	â€¢	Job posting:
	â€¢	Generate a dummy job posting event (e.g., â€œHiring Sales Coordinatorâ€).
	â€¢	Review event:
	â€¢	Fake a new Google review summary.
	3.	For each generated signal:
	â€¢	Store Signal in DB with:
	â€¢	source_type
	â€¢	raw_payload
	â€¢	context_summary (use LLM to summarize raw payload)
	â€¢	Then create a linked LeadEvent with:
	â€¢	summary (LLM-generated)
	â€¢	category inferred from content
	â€¢	urgency_score = 40â€“70
	â€¢	status = â€œnewâ€
	4.	Log each generated signal + lead event to stdout for debugging.

NOTE: This v1 is intentionally synthetic. It simulates the â€œobituary menâ€ noticing engine without hitting real APIs. Keep external API calls disabled unless explicitly added later.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SECTION 3 â€” BizDev Agent Upgrade (Event-Driven Outreach)

Modify run_bizdev_agent in agents.py:

New behavior:
	1.	Instead of sending outbound emails based on raw leads, select the next uncontacted LeadEvent:

event = db.query(LeadEvent).filter_by(status="new").first()


	2.	Pull associated company data.
	3.	Generate a contextual outbound email:
	â€¢	Lead with the signal summary (â€œNoticed X happenedâ€¦â€)
	â€¢	Infer the implication (â€œThis usually means Yâ€¦â€)
	â€¢	Offer assistance (â€œI can send a snapshot by 4pmâ€¦â€)
	4.	Use existing send_email() function:
	â€¢	DRY_RUN continues to display in admin console
	5.	Update LeadEvent status â†’ "contacted"
	6.	Store outbound message in a new or existing outbound_messages table if present.

Preserve all existing BizDev functionality and outbound logs.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SECTION 4 â€” Customer Portal Upgrade: â€œTodayâ€™s Opportunitiesâ€

Modify the template: templates/portal.html (or equivalent).

Add a new top-level section for each logged-in customer:

â€œTodayâ€™s Opportunitiesâ€ Panel
	â€¢	Fetch all LeadEvent rows associated with the customerâ€™s company.
	â€¢	Display fields:
	â€¢	summary
	â€¢	category
	â€¢	urgency_score
	â€¢	status (badge)
	â€¢	created_at
	â€¢	Sort by urgency_score desc, then by created_at desc.
	â€¢	Limit to last ~5â€“10 events.
	â€¢	Include a subtle note:
â€œThese opportunities were identified automatically from public context signals.â€

Design:
	â€¢	Noir theme consistent with site
	â€¢	Use subtle icons:
	â€¢	ğŸ”º for urgency
	â€¢	ğŸ•’ for timestamp
	â€¢	ğŸ“Œ for categories

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SECTION 5 â€” Admin Console Upgrade

Modify /admin page to include:

1. Signals Overview Table

Columns:
	â€¢	id
	â€¢	company
	â€¢	source_type
	â€¢	context_summary (truncated)
	â€¢	created_at

2. Lead Events Table

Columns:
	â€¢	id
	â€¢	company
	â€¢	summary
	â€¢	category
	â€¢	urgency_score
	â€¢	status
	â€¢	created_at

3. Button:

â€œRun Signals Agent Nowâ€ â†’ POST /api/run/signals

Create that route.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SECTION 6 â€” API Endpoints

Add:

POST /api/run/signals

Runs run_signals_agent.

GET /api/signals

Returns all signals (admin only).

GET /api/lead_events

Returns all lead events (admin only).

Preserve existing endpoints.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SECTION 7 â€” Adjust Subscription Logic

This part is minimal:
	â€¢	LeadEvents should NOT count against trial quotas.
	â€¢	Trial users can see opportunities, but BizDev agent should not send events automatically unless they â€œenable outreachâ€ (future toggle; for now, always DRY_RUN).
	â€¢	Paid users will eventually get real email sends.

Keep existing trial enforcement for tasks + Ops work.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SECTION 8 â€” Keep DRY_RUN Strictly On

Leave this intact:

EMAIL_MODE = "DRY_RUN"

Do NOT add real email sending behavior in this update.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

SECTION 9 â€” Final Integration Check

Before concluding the task, confirm:
	1.	DB models for Signal and LeadEvent exist and migrate.
	2.	Signals agent runs without crashing.
	3.	Lead events appear in admin.
	4.	BizDev agent writes contextual emails referencing lead events.
	5.	Customer portal shows â€œTodayâ€™s Opportunitiesâ€ panel.
	6.	No existing functionality is broken:
	â€¢	Signup
	â€¢	Login
	â€¢	Trials
	â€¢	Portal
	â€¢	Billing
	â€¢	Ops agent
	â€¢	Admin console

Provide a summary of all changed files at the end.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

END OF MASTER PROMPT

This is the one, Hoss.
This is the shift from:

â€œAI SaaSâ€ â†’ â€œContext Engine.â€

Run this in the Assistant once youâ€™re ready to evolve the entire organism.