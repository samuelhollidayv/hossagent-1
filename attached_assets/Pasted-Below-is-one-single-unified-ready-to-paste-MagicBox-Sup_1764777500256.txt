Below is one single unified, ready-to-paste MagicBox Superprompt that merges:
	â€¢	The full Ethical Briefcase / Signals Engine / Lead Lifecycle / Onboarding / CC upgrade
	â€¢	All Miami tuning
	â€¢	Your entire UAT Round 1 change list
	â€¢	All required portal/admin fixes
	â€¢	Clear, explicit implementation instructions
	â€¢	Safety + DRY_RUN + secrets hygiene

This is the exact text you drop into Replit Agent as the next major build step.

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸš€ HOSSAGENT MASTER SUPERPROMPT â€” FULL SYSTEM UPGRADE (Signals + Miami + UAT Fixes + Onboarding + Lifecycle + CC)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

You are working on my HossAgent app.
This prompt combines all required upgrades into one build plan.
Implement everything below without breaking existing functionality.
Maintain DRY_RUN safety, Secrets hygiene, and all prior features.

â¸»

ğŸ”¥ SECTION A â€” SYSTEM UPGRADE OVERVIEW

Transform HossAgent into a Contextual Opportunity Engine (â€œEthical Briefcaseâ€).
This includes:
	1.	Signals Engine upgrades
	2.	Miami-tuned lead generation
	3.	Business Onboarding / Profile system
	4.	Lead lifecycle overhaul
	5.	Outbound review vs. auto modes
	6.	CC + Reply-To visibility
	7.	Report surfacing
	8.	Admin Subscription Overrides
	9.	Portal layout + UX fixes
	10.	Usage counter fixes
	11.	Session persistence + Forgot Password Flow

Implement all of this cleanly, safely, and in modular steps.

â¸»

ğŸ”¥ SECTION B â€” MODELS & DATABASE CHANGES

B1 â€” LeadEvent Lifecycle Fields

Update the Lead / LeadEvent model to include:
	â€¢	status ENUM/string with values:
"NEW", "CONTACTED", "RESPONDED", "QUALIFIED", "CLOSED_WON", "CLOSED_LOST", "ON_HOLD"
	â€¢	last_contact_at (datetime)
	â€¢	last_contact_summary (text)
	â€¢	next_step (text)
	â€¢	next_step_owner ("AGENT" or "CUSTOMER")

Default:
status="NEW", everything else NULL.

â¸»

B2 â€” Business Profile Model

Create BusinessProfile linked 1:1 to each company/customer.

Fields:
	â€¢	company_id
	â€¢	short_description
	â€¢	services (JSON or text)
	â€¢	pricing_notes
	â€¢	ideal_customer
	â€¢	excluded_customers
	â€¢	voice_tone
	â€¢	communication_style
	â€¢	constraints
	â€¢	primary_contact_name
	â€¢	primary_contact_email â† used for CC + Reply-To
	â€¢	do_not_contact_list (JSON or text of domains/emails)

Apply migrations safely.

â¸»

B3 â€” Outreach Mode Per Customer

Add:
	â€¢	outreach_mode = "AUTO" or "REVIEW"
Default "AUTO".

â¸»

ğŸ”¥ SECTION C â€” SIGNALS ENGINE & MIAMI CONFIG

C1 â€” Verify and enforce Miami tuning

Use environment variables:
	â€¢	LEAD_GEOGRAPHY (e.g., "Miami, Broward, South Florida")
	â€¢	LEAD_NICHE (e.g., "med spa, HVAC, roofing, immigration lawyer, realtor, insurance, marketing agency")

Thread them through Signals agent:
	â€¢	Filter or score opportunities according to these.
	â€¢	Do NOT change their values.

C2 â€” LeadEvent initialization

When creating a LeadEvent:

Set:
	â€¢	status="NEW"
	â€¢	next_step_owner = "AGENT" if outreach is AUTO
	â€¢	next_step_owner = "CUSTOMER" if outreach is REVIEW
	â€¢	next_step = e.g.
	â€¢	"Sending intro email" for AUTO
	â€¢	"Awaiting your review" for REVIEW

Also increment leads_used (see Section E).

â¸»

ğŸ”¥ SECTION D â€” OUTBOUND EMAIL OVERHAUL

D1 â€” Respect Outreach Mode

If AUTO:
	â€¢	Generate email
	â€¢	Send immediately (or DRY_RUN log)
	â€¢	Update lead:
	â€¢	status="CONTACTED"
	â€¢	last_contact_at=now
	â€¢	last_contact_summary="Intro email sent"
	â€¢	next_step_owner="AGENT"

If REVIEW:
	â€¢	Generate email â†’ mark "PENDING" in outbound table
	â€¢	Lead remains NEW
	â€¢	Portal must show all pending outbound for customer approval
	â€¢	Actions:
	â€¢	Approve & Send â†’ send, update lifecycle
	â€¢	Edit & Send â†’ editable textbox â†’ send
	â€¢	Skip â†’ mark outbound "SKIPPED", optional status="ON_HOLD"

â¸»

D2 â€” CC + Reply-To Visibility

Every outbound email must:
	â€¢	To = prospect
	â€¢	CC = BusinessProfile.primary_contact_email
	â€¢	Reply-To = BusinessProfile.primary_contact_email

If missing profile â†’ warn in logs, but still DRY_RUN safely.

â¸»

D3 â€” Do-Not-Contact Enforcement

If prospect email/domain is in business profileâ€™s do_not_contact_list:
	â€¢	Skip auto-outreach
OR
	â€¢	Create lead but mark status="ON_HOLD" with reason.

â¸»

ğŸ”¥ SECTION E â€” USAGE COUNTERS

E1 â€” Leads Used

Increment leads_used every time a LeadEvent is created.

E2 â€” Tasks Used

Increment tasks_used whenever:
	â€¢	A research report is generated
	â€¢	An outbound email is prepared (AUTO or REVIEW)
	â€¢	A meaningful Ops task completes

E3 â€” Soft Caps

Do NOT block usage based on trial limits.
Show limits in UI but treat as soft.

â¸»

ğŸ”¥ SECTION F â€” REPORT STORAGE & SURFACING

F1 â€” Report Model

Create or extend a Report model:
	â€¢	id
	â€¢	company_id
	â€¢	lead_id (optional)
	â€¢	title
	â€¢	description
	â€¢	content or JSON blob
	â€¢	created_at

F2 â€” Portal â€œReports / Recent Workâ€ Section

In /portal:
	â€¢	Add a â€œReportsâ€ section listing all reports:
	â€¢	Date
	â€¢	Title
	â€¢	Short description
	â€¢	Expand or â€œView Reportâ€ detail page

F3 â€” Email Notifications

Still allowed but portal is source of truth.

â¸»

ğŸ”¥ SECTION G â€” PORTAL & ADMIN UX FIXES

G1 â€” Move Subscription Card to Top

In /portal template:
	â€¢	Place subscription status, trial days left, tasks/leads used, and â€œStart Paid Subscriptionâ€ at top.

â¸»

G2 â€” Add Pending Outreach Section for REVIEW Mode

â€œPending Outreachâ€ must display:
	â€¢	Each pending email
	â€¢	Context summary
	â€¢	Actions: Approve, Edit, Skip

â¸»

G3 â€” Admin Upgrade Button

Make the â€œUpgradeâ€ button in /admin functional:
	â€¢	Set subscription state:
	â€¢	status="ACTIVE"
	â€¢	plan="PRO"
	â€¢	billing_method="ADMIN_OVERRIDE"
	â€¢	Remove trial end
	â€¢	Do NOT require Stripe checkout
	â€¢	Portal should immediately reflect Paid status

â¸»

ğŸ”¥ SECTION H â€” AUTHENTICATION IMPROVEMENTS

H1 â€” Session Persistence

Implement:
	â€¢	Secure HTTP-only cookie
	â€¢	Expiration ~14 days
	â€¢	Auto-refresh on activity
	â€¢	/portal loads without re-login unless cookie expired

H2 â€” Logout

Clear session + redirect.

â¸»

H3 â€” Forgot Password Flow

Add:
	â€¢	â€œForgot your password?â€ link
	â€¢	Token table:
	â€¢	user_id
	â€¢	token
	â€¢	expires_at
	â€¢	Email reset link (DRY_RUN logs it)
	â€¢	Reset page:
	â€¢	Validate token
	â€¢	Set new password
	â€¢	Auto-login afterward

â¸»

ğŸ”¥ SECTION I â€” CUSTOMER CANCELLATION (MVP)

Add â€œCancel Subscriptionâ€ button for paid users:
	â€¢	Set cancelled_at_period_end=True
	â€¢	Portal message:
â€œYour subscription will remain active until the end of this billing period. You wonâ€™t be charged again.â€
	â€¢	Admin can reactivate or override anytime.

No Stripe API call required now.

â¸»

ğŸ”¥ SECTION J â€” PORTAL NAVIGATION / ACCESS FIXES

J1 â€” Add Business Profile / Settings Page

Editable fields from Section B2.

J2 â€” Improve Lead Detail Page

Show:
	â€¢	full lifecycle
	â€¢	last contact summary
	â€¢	next step owner
	â€¢	outbound history

J3 â€” Make â€œView as Customerâ€ still available in admin

â¸»

ğŸ”¥ SECTION K â€” POST-IMPLEMENTATION TEST PLAN

After implementing everything:
	1.	Create a new test customer
	2.	Complete onboarding
	3.	Generate a few signals â†’ verify leads_used increments
	4.	Generate reports â†’ verify tasks_used increments
	5.	Try both AUTO and REVIEW modes
	6.	Approve outbound + CC visibility
	7.	Confirm subscription card at top of portal
	8.	Test Forgot Password (DRY_RUN)
	9.	Test Cancel Subscription
	10.	Test Admin Upgrade
	11.	Test login persistence
	12.	Verify Miami filtering stays active

â¸»

ğŸ”¥ SECTION L â€” REQUIREMENTS
	â€¢	DO NOT hardcode secrets
	â€¢	Preserve DRY_RUN
	â€¢	Maintain existing flows
	â€¢	Summarize all file changes
	â€¢	Document TODO comments where appropriate

â¸»

ğŸš€ END OF SUPERPROMPT

Paste everything above into Replit Agent as the next task.
This is the complete unified spec for the next major evolution of HossAgent.